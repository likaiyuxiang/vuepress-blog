---
title: 智能派单
date: 2024-03-24
sidebar: 'auto'
categories:
 - frontEnd
tags:
 - java
 - 业务
---

# 智能派单

## 背景

- 卸货完成时存在质检员闲着无任务的情况，预期是有带质检的任务时不让质检员等待任务。
- 质检员不线下来回跑动，提高质检效率。
- 无人员接单的时候发送预警消息给主管/仓经理，方便主管进行干预。
- 高风险任务优先给高职级人员派发（会有小仓存在无高职级人员情况，该规则不是强卡控）。
- 先卸货的先派单，每个预约单都需要有质检员跟进。

## 目标

- 推动智能派单在RDC仓全量，准确派发减少转派干预和人动。
- 仓内管理人员有辅助决策的干预抓手，提供可视化管理工具。
  - 商家首件等待时长。
  - 转派任务占比。
  - 上线后质检人员人均步数增长。

## 方案

1. 派单以人的空闲状态作为派单触发点，当QC处于空闲状态时，给QC派发任务。（触发条件：QC开始接单、QC提交跳过任务、主管QC转派，一键收获、定时任务用于兜底等）
2. 物流侧构建的逻辑区中提取【收货区】标识作为派单点位，卸货时接收物流侧MQ对预约单的逻辑区进行标识。
3. 建立预约单和质检员的绑定关系，区分主和副质检员。
4. 介入前后端通信组件，派发任务后让任务界面自动刷新，同时主管切换QC质检点位时及时通知到QC。
5. 使用squirrel缓存任务信息，对任务预处理，减少DB查询。
6. 定时任务修正预约单状态。（存在任务尚未生成，但是卸货了。mq延迟消费，以及定时任务兜底）
7. 以人为角度进行派发（mq进行处理）。

## 智能派单的5个时机

1. QC开始接单、主管切换质检点位。
2. 质检任务提交后（完成、跳过、一键收获），对于某一个qc进行派单。
3. 卸货时触发空闲人员进行派单。
4. 转派任务时进行派单。
5. 每分钟扫描空闲人员进行派单（定时任务用于兜底）。

# 同园双仓共享

## 背景

1、智能派单上线后，同园仓直接使用智能派单会存在线上问题，现有规则不兼容（同园仓有些任务无需质检但还是进行派发。）



2、同园模式仓存在一个商家给两个仓供货相同sku的情况，预期是非高风险任务可以根据一些条件实现免qc质检。



---

同园双仓：具备质检任务共享能力的两个RDC仓。

---

| 需求点           | 描述                                                         |
| ---------------- | ------------------------------------------------------------ |
| 同园双仓任务共享 | 1、共享的条件<br />条件一：符合共享规则的合格任务进行共享，如果有多条任务，取提交时间最新的任务共享。<br />条件二：如果所有任务均不符合共享规则，判断是否存在带质检或者进行中的任务，对任务进行暂扣。<br />条件三：暂扣任务等待的任务提交后，若符合共享规则便进行共享，否则进行派单。<br />条件四：每个任务最多被共享一次。<br />2、禁止共享条件<br />存在高品退的sku，T日0点至今，存在不合格记录的。只能仓间共享，不能仓内共享。 |







